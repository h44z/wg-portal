import{d as R,a as y,A as U,b as D,u as A,c as P,r as E,w as B,o as u,e as M,f as S,_ as W,g as V,h as c,i as e,t as s,j as _,v as b,k as v,l as L,m as k,F as C,n as F,s as T,p as H,q as O,x as f,y as z,z as j}from"./index-4c1df829.js";const w="/user",N=R({id:"users",state:()=>({userPeers:[],users:[],filter:"",pageSize:10,pageOffset:0,pages:[],fetching:!1}),getters:{Find:t=>o=>t.users.find(h=>h.Identifier===o),Count:t=>t.users.length,FilteredCount:t=>t.Filtered.length,All:t=>t.users,Peers:t=>t.userPeers,Filtered:t=>t.filter?t.users.filter(o=>o.Firstname.includes(t.filter)||o.Lastname.includes(t.filter)||o.Email.includes(t.filter)||o.Identifier.includes(t.filter)):t.users,FilteredAndPaged:t=>t.Filtered.slice(t.pageOffset,t.pageOffset+t.pageSize),isFetching:t=>t.fetching,hasNextPage:t=>t.pageOffset<t.FilteredCount-t.pageSize,hasPrevPage:t=>t.pageOffset>0,currentPage:t=>t.pageOffset/t.pageSize+1},actions:{afterPageSizeChange(){this.pageOffset=0,this.calculatePages()},calculatePages(){let t=1;this.pages=[];for(let o=0;o<this.FilteredCount;o+=this.pageSize)this.pages.push(t++)},gotoPage(t){this.pageOffset=(t-1)*this.pageSize,this.calculatePages()},nextPage(){this.pageOffset+=this.pageSize,this.calculatePages()},previousPage(){this.pageOffset-=this.pageSize,this.calculatePages()},setUsers(t){this.users=t,this.calculatePages(),this.fetching=!1},setUserPeers(t){this.userPeers=t,this.fetching=!1},async LoadUsers(){return this.fetching=!0,y.get(`${w}/all`).then(this.setUsers).catch(t=>{this.setUsers([]),console.log("Failed to load users: ",t),U({title:"Backend Connection Failure",text:"Failed to load users!"})})},async DeleteUser(t){return this.fetching=!0,y.delete(`${w}/${D(t)}`).then(()=>{this.users=this.users.filter(o=>o.Identifier!==t),this.fetching=!1}).catch(o=>{throw this.fetching=!1,console.log(o),new Error(o)})},async UpdateUser(t,o){return this.fetching=!0,y.put(`${w}/${D(t)}`,o).then(h=>{let g=this.users.findIndex(r=>r.Identifier===t);this.users[g]=h,this.fetching=!1}).catch(h=>{throw this.fetching=!1,console.log(h),new Error(h)})},async CreateUser(t){return this.fetching=!0,y.post(`${w}/new`,t).then(o=>{this.users.push(o),this.fetching=!1}).catch(o=>{throw this.fetching=!1,console.log(o),new Error(o)})},async LoadUserPeers(t){return this.fetching=!0,y.get(`${w}/${D(t)}/peers`).then(this.setUserPeers).catch(o=>{this.setUserPeers([]),console.log("Failed to load user peers for ",t,": ",o),U({title:"Backend Connection Failure",text:"Failed to load user peers!"})})}}}),q={key:0},K={class:"mt-4"},G={key:0,class:"form-group"},J={class:"form-label mt-4"},Q=["placeholder"],X={class:"form-group"},Y={class:"form-label mt-4"},Z=["placeholder"],x={key:1,class:"form-group"},ee={class:"form-label mt-4"},se=["placeholder"],te={key:0,id:"passwordHelp",class:"form-text text-muted"},le={key:1},oe={class:"mt-4"},ae={class:"form-group"},ie={class:"form-label mt-4"},ne=["placeholder"],re={class:"row"},de={class:"form-group col-md-6"},ue={class:"form-label mt-4"},ce=["placeholder"],he={class:"form-group col-md-6"},pe={class:"form-label mt-4"},me=["placeholder"],fe={class:"row"},ve={class:"form-group col-md-6"},_e={class:"form-label mt-4"},ge=["placeholder"],be={class:"form-group col-md-6"},$e={class:"form-label mt-4"},ke=["placeholder"],ye={class:"mt-4"},we={class:"form-group"},Pe={class:"form-label mt-4"},Ce={class:"mt-4"},Ie={class:"form-check form-switch"},Ue={class:"form-check-label"},Se={class:"form-check form-switch"},Fe={class:"form-check-label"},De={key:0,class:"form-check form-switch"},Ve={class:"form-check-label"},Le={class:"flex-fill text-start"},ze=["onClick"],Ee=["onClick"],Ne=["onClick"],Oe={__name:"UserEditModal",props:{userId:String,visible:Boolean},emits:["close"],setup(t,{emit:o}){const h=t,{t:g}=A(),r=N(),a=P(()=>r.Find(h.userId)),n=P(()=>h.visible?a.value?g("modals.user-edit.headline-edit")+" "+a.value.Identifier:g("modals.user-edit.headline-new"):""),l=E(V());B(()=>h.visible,async(i,d)=>{d===!1&&i===!0&&(a.value?(l.value.Identifier=a.value.Identifier,l.value.Email=a.value.Email,l.value.Source=a.value.Source,l.value.IsAdmin=a.value.IsAdmin,l.value.Firstname=a.value.Firstname,l.value.Lastname=a.value.Lastname,l.value.Phone=a.value.Phone,l.value.Department=a.value.Department,l.value.Notes=a.value.Notes,l.value.Password="",l.value.Disabled=a.value.Disabled):l.value=V())});function $(){l.value=V(),o("close")}async function p(){try{h.userId!=="#NEW#"?await r.UpdateUser(a.value.Identifier,l.value):await r.CreateUser(l.value),$()}catch(i){U({title:"Failed to save user!",text:i.toString(),type:"error"})}}async function I(){try{await r.DeleteUser(a.value.Identifier),$()}catch(i){U({title:"Failed to delete user!",text:i.toString(),type:"error"})}}return(i,d)=>(u(),M(W,{title:n.value,visible:t.visible,onClose:$},{default:S(()=>[l.value.Source==="db"?(u(),c("fieldset",q,[e("legend",K,s(i.$t("modals.user-edit.header-general")),1),h.userId==="#NEW#"?(u(),c("div",G,[e("label",J,s(i.$t("modals.user-edit.identifier.label")),1),_(e("input",{"onUpdate:modelValue":d[0]||(d[0]=m=>l.value.Identifier=m),class:"form-control",placeholder:i.$t("modals.user-edit.identifier.placeholder"),type:"text"},null,8,Q),[[b,l.value.Identifier]])])):v("",!0),e("div",X,[e("label",Y,s(i.$t("modals.user-edit.source.label")),1),_(e("input",{"onUpdate:modelValue":d[1]||(d[1]=m=>l.value.Source=m),class:"form-control",disabled:"disabled",placeholder:i.$t("modals.user-edit.source.placeholder"),type:"text"},null,8,Z),[[b,l.value.Source]])]),l.value.Source==="db"?(u(),c("div",x,[e("label",ee,s(i.$t("modals.user-edit.password.label")),1),_(e("input",{"onUpdate:modelValue":d[2]||(d[2]=m=>l.value.Password=m),"aria-describedby":"passwordHelp",class:"form-control",placeholder:i.$t("modals.user-edit.password.placeholder"),type:"text"},null,8,se),[[b,l.value.Password]]),h.userId!=="#NEW#"?(u(),c("small",te,s(i.$t("modals.user-edit.password.description")),1)):v("",!0)])):v("",!0)])):v("",!0),l.value.Source==="db"?(u(),c("fieldset",le,[e("legend",oe,s(i.$t("modals.user-edit.header-personal")),1),e("div",ae,[e("label",ie,s(i.$t("modals.user-edit.email.label")),1),_(e("input",{"onUpdate:modelValue":d[3]||(d[3]=m=>l.value.Email=m),class:"form-control",placeholder:i.$t("modals.user-edit.email.placeholder"),type:"email"},null,8,ne),[[b,l.value.Email]])]),e("div",re,[e("div",de,[e("label",ue,s(i.$t("modals.user-edit.firstname.label")),1),_(e("input",{"onUpdate:modelValue":d[4]||(d[4]=m=>l.value.Firstname=m),class:"form-control",placeholder:i.$t("modals.user-edit.firstname.placeholder"),type:"text"},null,8,ce),[[b,l.value.Firstname]])]),e("div",he,[e("label",pe,s(i.$t("modals.user-edit.lastname.label")),1),_(e("input",{"onUpdate:modelValue":d[5]||(d[5]=m=>l.value.Lastname=m),class:"form-control",placeholder:i.$t("modals.user-edit.lastname.placeholder"),type:"text"},null,8,me),[[b,l.value.Lastname]])])]),e("div",fe,[e("div",ve,[e("label",_e,s(i.$t("modals.user-edit.phone.label")),1),_(e("input",{"onUpdate:modelValue":d[6]||(d[6]=m=>l.value.Phone=m),class:"form-control",placeholder:i.$t("modals.user-edit.phone.placeholder"),type:"text"},null,8,ge),[[b,l.value.Phone]])]),e("div",be,[e("label",$e,s(i.$t("modals.user-edit.department.label")),1),_(e("input",{"onUpdate:modelValue":d[7]||(d[7]=m=>l.value.Department=m),class:"form-control",placeholder:i.$t("modals.user-edit.department.placeholder"),type:"text"},null,8,ke),[[b,l.value.Department]])])])])):v("",!0),e("fieldset",null,[e("legend",ye,s(i.$t("modals.user-edit.header-notes")),1),e("div",we,[e("label",Pe,s(i.$t("modals.user-edit.notes.label")),1),_(e("textarea",{"onUpdate:modelValue":d[8]||(d[8]=m=>l.value.Notes=m),class:"form-control",rows:"2"},null,512),[[b,l.value.Notes]])])]),e("fieldset",null,[e("legend",Ce,s(i.$t("modals.user-edit.header-state")),1),e("div",Ie,[_(e("input",{"onUpdate:modelValue":d[9]||(d[9]=m=>l.value.Disabled=m),class:"form-check-input",type:"checkbox"},null,512),[[L,l.value.Disabled]]),e("label",Ue,s(i.$t("modals.user-edit.disabled.label")),1)]),e("div",Se,[_(e("input",{"onUpdate:modelValue":d[10]||(d[10]=m=>l.value.Locked=m),class:"form-check-input",type:"checkbox"},null,512),[[L,l.value.Locked]]),e("label",Fe,s(i.$t("modals.user-edit.locked.label")),1)]),l.value.Source==="db"?(u(),c("div",De,[_(e("input",{"onUpdate:modelValue":d[11]||(d[11]=m=>l.value.IsAdmin=m),checked:"",class:"form-check-input",type:"checkbox"},null,512),[[L,l.value.IsAdmin]]),e("label",Ve,s(i.$t("modals.user-edit.admin.label")),1)])):v("",!0)])]),footer:S(()=>[e("div",Le,[h.userId!=="#NEW#"&&l.value.Source==="db"?(u(),c("button",{key:0,class:"btn btn-danger me-1",type:"button",onClick:k(I,["prevent"])},s(i.$t("general.delete")),9,ze)):v("",!0)]),e("button",{class:"btn btn-primary me-1",type:"button",onClick:k(p,["prevent"])},s(i.$t("general.save")),9,Ee),e("button",{class:"btn btn-secondary",type:"button",onClick:k($,["prevent"])},s(i.$t("general.close")),9,Ne)]),_:1},8,["title","visible"]))}},Ae={class:"nav nav-tabs"},Be={class:"nav-item"},Me={class:"nav-link active","data-bs-toggle":"tab",href:"#user"},We={class:"nav-item"},Re={class:"nav-link","data-bs-toggle":"tab",href:"#peers"},Te={id:"interfaceTabs",class:"tab-content"},He={id:"user",class:"tab-pane fade active show"},je={class:"list-group list-group-flush"},qe={class:"list-group-item"},Ke={class:"table table-sm table-borderless device-status-table"},Ge={key:0},Je={key:1},Qe={key:0,class:"list-group-item"},Xe={class:"table table-sm table-borderless device-status-table"},Ye={id:"peers",class:"tab-pane fade"},Ze={key:0,class:"list-group list-group-flush"},xe={class:"list-group-item"},es={key:1,id:"peerTable",class:"table table-sm"},ss={scope:"col"},ts={scope:"col"},ls={scope:"col"},os=e("th",{scope:"col"},null,-1),as=["onClick"],is={__name:"UserViewModal",props:{userId:String,visible:Boolean},emits:["close"],setup(t,{emit:o}){const h=t,{t:g}=A(),r=N(),a=P(()=>{let p=r.Find(h.userId);return p||{}}),n=P(()=>h.visible?g("modals.user-view.headline")+" "+a.value.Identifier:""),l=P(()=>r.Peers);B(()=>h.visible,async(p,I)=>{I===!1&&p===!0&&await r.LoadUserPeers(a.value.Identifier)});function $(){o("close")}return(p,I)=>(u(),M(W,{title:n.value,visible:t.visible,onClose:$},{default:S(()=>[e("ul",Ae,[e("li",Be,[e("a",Me,s(p.$t("modals.user-view.tab-user")),1)]),e("li",We,[e("a",Re,s(p.$t("modals.user-view.tab-peers")),1)])]),e("div",Te,[e("div",He,[e("ul",je,[e("li",qe,[e("h4",null,s(p.$t("modals.user-view.headline-info")),1),e("table",Ke,[e("tbody",null,[e("tr",null,[e("td",null,s(p.$t("modals.user-view.email"))+":",1),e("td",null,s(a.value.Email),1)]),e("tr",null,[e("td",null,s(p.$t("modals.user-view.firstname"))+":",1),e("td",null,s(a.value.Firstname),1)]),e("tr",null,[e("td",null,s(p.$t("modals.user-view.lastname"))+":",1),e("td",null,s(a.value.Lastname),1)]),e("tr",null,[e("td",null,s(p.$t("modals.user-view.phone"))+":",1),e("td",null,s(a.value.Phone),1)]),e("tr",null,[e("td",null,s(p.$t("modals.user-view.department"))+":",1),e("td",null,s(a.value.Department),1)]),a.value.Disabled?(u(),c("tr",Ge,[e("td",null,s(p.$t("modals.user-view.disabled"))+":",1),e("td",null,s(a.value.DisabledReason),1)])):v("",!0),a.value.Locked?(u(),c("tr",Je,[e("td",null,s(p.$t("modals.user-view.locked"))+":",1),e("td",null,s(a.value.LockedReason),1)])):v("",!0)])])]),a.value.Notes?(u(),c("li",Qe,[e("h4",null,s(p.$t("modals.user-view.headline-notes")),1),e("table",Xe,[e("tbody",null,[e("tr",null,[e("td",null,s(a.value.Notes),1)])])])])):v("",!0)])]),e("div",Ye,[l.value.length===0?(u(),c("ul",Ze,[e("li",xe,s(p.$t("modals.user-view.no-peers")),1)])):v("",!0),l.value.length!==0?(u(),c("table",es,[e("thead",null,[e("tr",null,[e("th",ss,s(p.$t("modals.user-view.peers.name")),1),e("th",ts,s(p.$t("modals.user-view.peers.interface")),1),e("th",ls,s(p.$t("modals.user-view.peers.ip")),1),os])]),e("tbody",null,[(u(!0),c(C,null,F(l.value,i=>(u(),c("tr",{key:i.Identifier},[e("td",null,s(i.DisplayName),1),e("td",null,s(i.InterfaceIdentifier),1),e("td",null,[(u(!0),c(C,null,F(i.Addresses,d=>(u(),c("span",{key:d,class:"badge pill bg-light"},s(d),1))),128))])]))),128))])])):v("",!0)])])]),footer:S(()=>[e("button",{class:"btn btn-primary",type:"button",onClick:k($,["prevent"])},s(p.$t("general.close")),9,as)]),_:1},8,["title","visible"]))}},ns={class:"mt-4 row"},rs={class:"col-12 col-lg-5"},ds={class:"col-12 col-lg-4 text-lg-end"},us={class:"form-group d-inline"},cs={class:"input-group mb-3"},hs=["placeholder"],ps=["title"],ms=e("i",{class:"fa-solid fa-search"},null,-1),fs=[ms],vs={class:"col-12 col-lg-3 text-lg-end"},_s=["title"],gs=e("i",{class:"fa fa-plus me-1"},null,-1),bs=e("i",{class:"fa fa-user"},null,-1),$s=[gs,bs],ks={class:"mt-2 table-responsive"},ys={key:0},ws={key:1,id:"userTable",class:"table table-sm"},Ps={scope:"col"},Cs=["title"],Is=e("th",{scope:"col"},null,-1),Us={scope:"col"},Ss={scope:"col"},Fs={scope:"col"},Ds={scope:"col"},Vs={class:"text-center",scope:"col"},Ls={class:"text-center",scope:"col"},zs={class:"text-center",scope:"col"},Es=e("th",{scope:"col"},null,-1),Ns=e("th",{scope:"row"},[e("input",{id:"flexCheckDefault",class:"form-check-input",type:"checkbox",value:""})],-1),Os={class:"text-center"},As=["title"],Bs=e("i",{class:"fa fa-circle-xmark"},null,-1),Ms=[Bs],Ws=["title"],Rs=e("i",{class:"fas fa-lock"},null,-1),Ts=[Rs],Hs={class:"text-center"},js={class:"badge rounded-pill bg-light"},qs={class:"text-center"},Ks={class:"text-center"},Gs=["title"],Js=e("i",{class:"fa fa-check-circle"},null,-1),Qs=[Js],Xs={key:1},Ys=["title"],Zs={class:"text-center"},xs=["title","onClick"],et=e("i",{class:"fas fa-eye me-2"},null,-1),st=[et],tt=["title","onClick"],lt=e("i",{class:"fas fa-cog me-2"},null,-1),ot=[lt],at=e("hr",null,null,-1),it={class:"mt-3"},nt={class:"row"},rt={class:"col-6"},dt={class:"pagination pagination-sm"},ut=["onClick"],ct={class:"col-6"},ht={class:"form-group row"},pt={class:"col-sm-6 col-form-label text-end",for:"paginationSelector"},mt={class:"col-sm-6"},ft=e("option",{value:"10"},"10",-1),vt=e("option",{value:"25"},"25",-1),_t=e("option",{value:"50"},"50",-1),gt=e("option",{value:"100"},"100",-1),bt={value:"999999999"},kt={__name:"UserView",setup(t){T();const o=N(),h=E(""),g=E("");return H(()=>{o.LoadUsers()}),(r,a)=>(u(),c(C,null,[O(Oe,{userId:h.value,visible:h.value!=="",onClose:a[0]||(a[0]=n=>h.value="")},null,8,["userId","visible"]),O(is,{userId:g.value,visible:g.value!=="",onClose:a[1]||(a[1]=n=>g.value="")},null,8,["userId","visible"]),e("div",ns,[e("div",rs,[e("h1",null,s(r.$t("users.headline")),1)]),e("div",ds,[e("div",us,[e("div",cs,[_(e("input",{"onUpdate:modelValue":a[2]||(a[2]=n=>f(o).filter=n),class:"form-control",placeholder:r.$t("general.search.placeholder"),type:"text",onKeyup:a[3]||(a[3]=(...n)=>f(o).afterPageSizeChange&&f(o).afterPageSizeChange(...n))},null,40,hs),[[b,f(o).filter]]),e("button",{class:"input-group-text btn btn-primary",title:r.$t("general.search.button")},fs,8,ps)])])]),e("div",vs,[e("a",{class:"btn btn-primary ms-2",href:"#",title:r.$t("users.button-add-user"),onClick:a[4]||(a[4]=k(n=>h.value="#NEW#",["prevent"]))},$s,8,_s)])]),e("div",ks,[f(o).Count===0?(u(),c("div",ys,[e("h4",null,s(r.$t("users.no-user.headline")),1),e("p",null,s(r.$t("users.no-user.abstract")),1)])):v("",!0),f(o).Count!==0?(u(),c("table",ws,[e("thead",null,[e("tr",null,[e("th",Ps,[e("input",{id:"flexCheckDefault",class:"form-check-input",title:r.$t("general.select-all"),type:"checkbox",value:""},null,8,Cs)]),Is,e("th",Us,s(r.$t("users.table-heading.id")),1),e("th",Ss,s(r.$t("users.table-heading.email")),1),e("th",Fs,s(r.$t("users.table-heading.firstname")),1),e("th",Ds,s(r.$t("users.table-heading.lastname")),1),e("th",Vs,s(r.$t("users.table-heading.source")),1),e("th",Ls,s(r.$t("users.table-heading.peers")),1),e("th",zs,s(r.$t("users.table-heading.admin")),1),Es])]),e("tbody",null,[(u(!0),c(C,null,F(f(o).FilteredAndPaged,n=>(u(),c("tr",{key:n.Identifier},[Ns,e("td",Os,[n.Disabled?(u(),c("span",{key:0,class:"text-danger",title:r.$t("users.user-disabled")+" "+n.DisabledReason},Ms,8,As)):v("",!0),n.Locked?(u(),c("span",{key:1,class:"text-danger",title:r.$t("users.user-locked")+" "+n.LockedReason},Ts,8,Ws)):v("",!0)]),e("td",null,s(n.Identifier),1),e("td",null,s(n.Email),1),e("td",null,s(n.Firstname),1),e("td",null,s(n.Lastname),1),e("td",Hs,[e("span",js,s(n.Source),1)]),e("td",qs,s(n.PeerCount),1),e("td",Ks,[n.IsAdmin?(u(),c("span",{key:0,class:"text-danger",title:r.$t("users.admin")},Qs,8,Gs)):(u(),c("span",Xs,[e("i",{class:"fa fa-circle-xmark",title:r.$t("users.no-admin")},null,8,Ys)]))]),e("td",Zs,[e("a",{href:"#",title:r.$t("users.button-show-user"),onClick:k(l=>g.value=n.Identifier,["prevent"])},st,8,xs),e("a",{href:"#",title:r.$t("users.button-edit-user"),onClick:k(l=>h.value=n.Identifier,["prevent"])},ot,8,tt)])]))),128))])])):v("",!0)]),at,e("div",it,[e("div",nt,[e("div",rt,[e("ul",dt,[e("li",{class:z([{disabled:f(o).pageOffset===0},"page-item"])},[e("a",{class:"page-link",onClick:a[5]||(a[5]=(...n)=>f(o).previousPage&&f(o).previousPage(...n))},"«")],2),(u(!0),c(C,null,F(f(o).pages,n=>(u(),c("li",{key:n,class:z([{active:f(o).currentPage===n},"page-item"])},[e("a",{class:"page-link",onClick:l=>f(o).gotoPage(n)},s(n),9,ut)],2))),128)),e("li",{class:z([{disabled:!f(o).hasNextPage},"page-item"])},[e("a",{class:"page-link",onClick:a[6]||(a[6]=(...n)=>f(o).nextPage&&f(o).nextPage(...n))},"»")],2)])]),e("div",ct,[e("div",ht,[e("label",pt,s(r.$t("general.pagination.size"))+":",1),e("div",mt,[_(e("select",{"onUpdate:modelValue":a[7]||(a[7]=n=>f(o).pageSize=n),class:"form-select",onClick:a[8]||(a[8]=n=>f(o).afterPageSizeChange())},[ft,vt,_t,gt,e("option",bt,s(r.$t("general.pagination.all")),1)],512),[[j,f(o).pageSize,void 0,{number:!0}]])])])])])])],64))}};export{kt as default};
