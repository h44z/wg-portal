import{d as T,a as w,S,b as V,u as B,c as I,r as N,w as M,o as d,e as W,f as F,_ as R,g as L,h as u,i as e,t as s,j as g,v as b,k as v,l as z,m as k,F as U,n as D,s as H,p as j,q as A,x as m,y as E,z as q}from"./index-9ks1MleN.js";const P="/user",O=T({id:"users",state:()=>({userPeers:[],users:[],filter:"",pageSize:10,pageOffset:0,pages:[],fetching:!1}),getters:{Find:l=>o=>l.users.find(f=>f.Identifier===o),Count:l=>l.users.length,FilteredCount:l=>l.Filtered.length,All:l=>l.users,Peers:l=>l.userPeers,Filtered:l=>l.filter?l.users.filter(o=>o.Firstname.includes(l.filter)||o.Lastname.includes(l.filter)||o.Email.includes(l.filter)||o.Identifier.includes(l.filter)):l.users,FilteredAndPaged:l=>l.Filtered.slice(l.pageOffset,l.pageOffset+l.pageSize),isFetching:l=>l.fetching,hasNextPage:l=>l.pageOffset<l.FilteredCount-l.pageSize,hasPrevPage:l=>l.pageOffset>0,currentPage:l=>l.pageOffset/l.pageSize+1},actions:{afterPageSizeChange(){this.pageOffset=0,this.calculatePages()},calculatePages(){let l=1;this.pages=[];for(let o=0;o<this.FilteredCount;o+=this.pageSize)this.pages.push(l++)},gotoPage(l){this.pageOffset=(l-1)*this.pageSize,this.calculatePages()},nextPage(){this.pageOffset+=this.pageSize,this.calculatePages()},previousPage(){this.pageOffset-=this.pageSize,this.calculatePages()},setUsers(l){this.users=l,this.calculatePages(),this.fetching=!1},setUserPeers(l){this.userPeers=l,this.fetching=!1},async LoadUsers(){return this.fetching=!0,w.get(`${P}/all`).then(this.setUsers).catch(l=>{this.setUsers([]),console.log("Failed to load users: ",l),S({title:"Backend Connection Failure",text:"Failed to load users!"})})},async DeleteUser(l){return this.fetching=!0,w.delete(`${P}/${V(l)}`).then(()=>{this.users=this.users.filter(o=>o.Identifier!==l),this.fetching=!1}).catch(o=>{throw this.fetching=!1,console.log(o),new Error(o)})},async UpdateUser(l,o){return this.fetching=!0,w.put(`${P}/${V(l)}`,o).then(f=>{let _=this.users.findIndex(n=>n.Identifier===l);this.users[_]=f,this.fetching=!1}).catch(f=>{throw this.fetching=!1,console.log(f),new Error(f)})},async CreateUser(l){return this.fetching=!0,w.post(`${P}/new`,l).then(o=>{this.users.push(o),this.fetching=!1}).catch(o=>{throw this.fetching=!1,console.log(o),new Error(o)})},async LoadUserPeers(l){return this.fetching=!0,w.get(`${P}/${V(l)}/peers`).then(this.setUserPeers).catch(o=>{this.setUserPeers([]),console.log("Failed to load user peers for ",l,": ",o),S({title:"Backend Connection Failure",text:"Failed to load user peers!"})})}}}),K={key:0},G={class:"mt-4"},J={key:0,class:"form-group"},Q={class:"form-label mt-4"},X=["placeholder"],Y={class:"form-group"},Z={class:"form-label mt-4"},x=["placeholder"],ee={key:1,class:"form-group"},se={class:"form-label mt-4"},te=["placeholder"],le={key:0,id:"passwordHelp",class:"form-text text-muted"},oe={key:1},ae={class:"mt-4"},ie={class:"form-group"},ne={class:"form-label mt-4"},re=["placeholder"],de={class:"row"},ue={class:"form-group col-md-6"},ce={class:"form-label mt-4"},he=["placeholder"],pe={class:"form-group col-md-6"},me={class:"form-label mt-4"},fe=["placeholder"],ve={class:"row"},_e={class:"form-group col-md-6"},ge={class:"form-label mt-4"},be=["placeholder"],$e={class:"form-group col-md-6"},ke={class:"form-label mt-4"},ye=["placeholder"],we={class:"mt-4"},Pe={class:"form-group"},Ie={class:"form-label mt-4"},Ue={class:"mt-4"},Ce={class:"form-check form-switch"},Se={class:"form-check-label"},Fe={class:"form-check form-switch"},De={class:"form-check-label"},Ve={key:0,class:"form-check form-switch"},Le={class:"form-check-label"},ze={class:"flex-fill text-start"},Ee={__name:"UserEditModal",props:{userId:String,visible:Boolean},emits:["close"],setup(l,{emit:o}){const{t:f}=B(),_=O(),n=l,p=o,t=I(()=>_.Find(n.userId)),y=I(()=>n.visible?t.value?f("modals.user-edit.headline-edit")+" "+t.value.Identifier:f("modals.user-edit.headline-new"):""),a=N(L());M(()=>n.visible,async(i,r)=>{r===!1&&i===!0&&(t.value?(a.value.Identifier=t.value.Identifier,a.value.Email=t.value.Email,a.value.Source=t.value.Source,a.value.IsAdmin=t.value.IsAdmin,a.value.Firstname=t.value.Firstname,a.value.Lastname=t.value.Lastname,a.value.Phone=t.value.Phone,a.value.Department=t.value.Department,a.value.Notes=t.value.Notes,a.value.Password="",a.value.Disabled=t.value.Disabled):a.value=L())});function $(){a.value=L(),p("close")}async function c(){try{n.userId!=="#NEW#"?await _.UpdateUser(t.value.Identifier,a.value):await _.CreateUser(a.value),$()}catch(i){S({title:"Failed to save user!",text:i.toString(),type:"error"})}}async function C(){try{await _.DeleteUser(t.value.Identifier),$()}catch(i){S({title:"Failed to delete user!",text:i.toString(),type:"error"})}}return(i,r)=>(d(),W(R,{title:y.value,visible:l.visible,onClose:$},{default:F(()=>[a.value.Source==="db"?(d(),u("fieldset",K,[e("legend",G,s(i.$t("modals.user-edit.header-general")),1),n.userId==="#NEW#"?(d(),u("div",J,[e("label",Q,s(i.$t("modals.user-edit.identifier.label")),1),g(e("input",{"onUpdate:modelValue":r[0]||(r[0]=h=>a.value.Identifier=h),class:"form-control",placeholder:i.$t("modals.user-edit.identifier.placeholder"),type:"text"},null,8,X),[[b,a.value.Identifier]])])):v("",!0),e("div",Y,[e("label",Z,s(i.$t("modals.user-edit.source.label")),1),g(e("input",{"onUpdate:modelValue":r[1]||(r[1]=h=>a.value.Source=h),class:"form-control",disabled:"disabled",placeholder:i.$t("modals.user-edit.source.placeholder"),type:"text"},null,8,x),[[b,a.value.Source]])]),a.value.Source==="db"?(d(),u("div",ee,[e("label",se,s(i.$t("modals.user-edit.password.label")),1),g(e("input",{"onUpdate:modelValue":r[2]||(r[2]=h=>a.value.Password=h),"aria-describedby":"passwordHelp",class:"form-control",placeholder:i.$t("modals.user-edit.password.placeholder"),type:"text"},null,8,te),[[b,a.value.Password]]),n.userId!=="#NEW#"?(d(),u("small",le,s(i.$t("modals.user-edit.password.description")),1)):v("",!0)])):v("",!0)])):v("",!0),a.value.Source==="db"?(d(),u("fieldset",oe,[e("legend",ae,s(i.$t("modals.user-edit.header-personal")),1),e("div",ie,[e("label",ne,s(i.$t("modals.user-edit.email.label")),1),g(e("input",{"onUpdate:modelValue":r[3]||(r[3]=h=>a.value.Email=h),class:"form-control",placeholder:i.$t("modals.user-edit.email.placeholder"),type:"email"},null,8,re),[[b,a.value.Email]])]),e("div",de,[e("div",ue,[e("label",ce,s(i.$t("modals.user-edit.firstname.label")),1),g(e("input",{"onUpdate:modelValue":r[4]||(r[4]=h=>a.value.Firstname=h),class:"form-control",placeholder:i.$t("modals.user-edit.firstname.placeholder"),type:"text"},null,8,he),[[b,a.value.Firstname]])]),e("div",pe,[e("label",me,s(i.$t("modals.user-edit.lastname.label")),1),g(e("input",{"onUpdate:modelValue":r[5]||(r[5]=h=>a.value.Lastname=h),class:"form-control",placeholder:i.$t("modals.user-edit.lastname.placeholder"),type:"text"},null,8,fe),[[b,a.value.Lastname]])])]),e("div",ve,[e("div",_e,[e("label",ge,s(i.$t("modals.user-edit.phone.label")),1),g(e("input",{"onUpdate:modelValue":r[6]||(r[6]=h=>a.value.Phone=h),class:"form-control",placeholder:i.$t("modals.user-edit.phone.placeholder"),type:"text"},null,8,be),[[b,a.value.Phone]])]),e("div",$e,[e("label",ke,s(i.$t("modals.user-edit.department.label")),1),g(e("input",{"onUpdate:modelValue":r[7]||(r[7]=h=>a.value.Department=h),class:"form-control",placeholder:i.$t("modals.user-edit.department.placeholder"),type:"text"},null,8,ye),[[b,a.value.Department]])])])])):v("",!0),e("fieldset",null,[e("legend",we,s(i.$t("modals.user-edit.header-notes")),1),e("div",Pe,[e("label",Ie,s(i.$t("modals.user-edit.notes.label")),1),g(e("textarea",{"onUpdate:modelValue":r[8]||(r[8]=h=>a.value.Notes=h),class:"form-control",rows:"2"},null,512),[[b,a.value.Notes]])])]),e("fieldset",null,[e("legend",Ue,s(i.$t("modals.user-edit.header-state")),1),e("div",Ce,[g(e("input",{"onUpdate:modelValue":r[9]||(r[9]=h=>a.value.Disabled=h),class:"form-check-input",type:"checkbox"},null,512),[[z,a.value.Disabled]]),e("label",Se,s(i.$t("modals.user-edit.disabled.label")),1)]),e("div",Fe,[g(e("input",{"onUpdate:modelValue":r[10]||(r[10]=h=>a.value.Locked=h),class:"form-check-input",type:"checkbox"},null,512),[[z,a.value.Locked]]),e("label",De,s(i.$t("modals.user-edit.locked.label")),1)]),a.value.Source==="db"?(d(),u("div",Ve,[g(e("input",{"onUpdate:modelValue":r[11]||(r[11]=h=>a.value.IsAdmin=h),checked:"",class:"form-check-input",type:"checkbox"},null,512),[[z,a.value.IsAdmin]]),e("label",Le,s(i.$t("modals.user-edit.admin.label")),1)])):v("",!0)])]),footer:F(()=>[e("div",ze,[n.userId!=="#NEW#"&&a.value.Source==="db"?(d(),u("button",{key:0,class:"btn btn-danger me-1",type:"button",onClick:k(C,["prevent"])},s(i.$t("general.delete")),1)):v("",!0)]),e("button",{class:"btn btn-primary me-1",type:"button",onClick:k(c,["prevent"])},s(i.$t("general.save")),1),e("button",{class:"btn btn-secondary",type:"button",onClick:k($,["prevent"])},s(i.$t("general.close")),1)]),_:1},8,["title","visible"]))}},Ne={class:"nav nav-tabs"},Oe={class:"nav-item"},Ae={class:"nav-link active","data-bs-toggle":"tab",href:"#user"},Be={class:"nav-item"},Me={class:"nav-link","data-bs-toggle":"tab",href:"#peers"},We={id:"interfaceTabs",class:"tab-content"},Re={id:"user",class:"tab-pane fade active show"},Te={class:"list-group list-group-flush"},He={class:"list-group-item"},je={class:"table table-sm table-borderless device-status-table"},qe={key:0},Ke={key:1},Ge={key:0,class:"list-group-item"},Je={class:"table table-sm table-borderless device-status-table"},Qe={id:"peers",class:"tab-pane fade"},Xe={key:0,class:"list-group list-group-flush"},Ye={class:"list-group-item"},Ze={key:1,id:"peerTable",class:"table table-sm"},xe={scope:"col"},es={scope:"col"},ss={scope:"col"},ts=e("th",{scope:"col"},null,-1),ls={__name:"UserViewModal",props:{userId:String,visible:Boolean},emits:["close"],setup(l,{emit:o}){const{t:f}=B(),_=O(),n=l,p=o,t=I(()=>{let c=_.Find(n.userId);return c||{}}),y=I(()=>n.visible?f("modals.user-view.headline")+" "+t.value.Identifier:""),a=I(()=>_.Peers);M(()=>n.visible,async(c,C)=>{C===!1&&c===!0&&await _.LoadUserPeers(t.value.Identifier)});function $(){p("close")}return(c,C)=>(d(),W(R,{title:y.value,visible:l.visible,onClose:$},{default:F(()=>[e("ul",Ne,[e("li",Oe,[e("a",Ae,s(c.$t("modals.user-view.tab-user")),1)]),e("li",Be,[e("a",Me,s(c.$t("modals.user-view.tab-peers")),1)])]),e("div",We,[e("div",Re,[e("ul",Te,[e("li",He,[e("h4",null,s(c.$t("modals.user-view.headline-info")),1),e("table",je,[e("tbody",null,[e("tr",null,[e("td",null,s(c.$t("modals.user-view.email"))+":",1),e("td",null,s(t.value.Email),1)]),e("tr",null,[e("td",null,s(c.$t("modals.user-view.firstname"))+":",1),e("td",null,s(t.value.Firstname),1)]),e("tr",null,[e("td",null,s(c.$t("modals.user-view.lastname"))+":",1),e("td",null,s(t.value.Lastname),1)]),e("tr",null,[e("td",null,s(c.$t("modals.user-view.phone"))+":",1),e("td",null,s(t.value.Phone),1)]),e("tr",null,[e("td",null,s(c.$t("modals.user-view.department"))+":",1),e("td",null,s(t.value.Department),1)]),t.value.Disabled?(d(),u("tr",qe,[e("td",null,s(c.$t("modals.user-view.disabled"))+":",1),e("td",null,s(t.value.DisabledReason),1)])):v("",!0),t.value.Locked?(d(),u("tr",Ke,[e("td",null,s(c.$t("modals.user-view.locked"))+":",1),e("td",null,s(t.value.LockedReason),1)])):v("",!0)])])]),t.value.Notes?(d(),u("li",Ge,[e("h4",null,s(c.$t("modals.user-view.headline-notes")),1),e("table",Je,[e("tbody",null,[e("tr",null,[e("td",null,s(t.value.Notes),1)])])])])):v("",!0)])]),e("div",Qe,[a.value.length===0?(d(),u("ul",Xe,[e("li",Ye,s(c.$t("modals.user-view.no-peers")),1)])):v("",!0),a.value.length!==0?(d(),u("table",Ze,[e("thead",null,[e("tr",null,[e("th",xe,s(c.$t("modals.user-view.peers.name")),1),e("th",es,s(c.$t("modals.user-view.peers.interface")),1),e("th",ss,s(c.$t("modals.user-view.peers.ip")),1),ts])]),e("tbody",null,[(d(!0),u(U,null,D(a.value,i=>(d(),u("tr",{key:i.Identifier},[e("td",null,s(i.DisplayName),1),e("td",null,s(i.InterfaceIdentifier),1),e("td",null,[(d(!0),u(U,null,D(i.Addresses,r=>(d(),u("span",{key:r,class:"badge pill bg-light"},s(r),1))),128))])]))),128))])])):v("",!0)])])]),footer:F(()=>[e("button",{class:"btn btn-primary",type:"button",onClick:k($,["prevent"])},s(c.$t("general.close")),1)]),_:1},8,["title","visible"]))}},os={class:"mt-4 row"},as={class:"col-12 col-lg-5"},is={class:"col-12 col-lg-4 text-lg-end"},ns={class:"form-group d-inline"},rs={class:"input-group mb-3"},ds=["placeholder"],us=["title"],cs=e("i",{class:"fa-solid fa-search"},null,-1),hs=[cs],ps={class:"col-12 col-lg-3 text-lg-end"},ms=["title"],fs=e("i",{class:"fa fa-plus me-1"},null,-1),vs=e("i",{class:"fa fa-user"},null,-1),_s=[fs,vs],gs={class:"mt-2 table-responsive"},bs={key:0},$s={key:1,id:"userTable",class:"table table-sm"},ks={scope:"col"},ys=["title"],ws=e("th",{scope:"col"},null,-1),Ps={scope:"col"},Is={scope:"col"},Us={scope:"col"},Cs={scope:"col"},Ss={class:"text-center",scope:"col"},Fs={class:"text-center",scope:"col"},Ds={class:"text-center",scope:"col"},Vs=e("th",{scope:"col"},null,-1),Ls=e("th",{scope:"row"},[e("input",{id:"flexCheckDefault",class:"form-check-input",type:"checkbox",value:""})],-1),zs={class:"text-center"},Es=["title"],Ns=e("i",{class:"fa fa-circle-xmark"},null,-1),Os=[Ns],As=["title"],Bs=e("i",{class:"fas fa-lock"},null,-1),Ms=[Bs],Ws={class:"text-center"},Rs={class:"badge rounded-pill bg-light"},Ts={class:"text-center"},Hs={class:"text-center"},js=["title"],qs=e("i",{class:"fa fa-check-circle"},null,-1),Ks=[qs],Gs={key:1},Js=["title"],Qs={class:"text-center"},Xs=["title","onClick"],Ys=e("i",{class:"fas fa-eye me-2"},null,-1),Zs=[Ys],xs=["title","onClick"],et=e("i",{class:"fas fa-cog me-2"},null,-1),st=[et],tt=e("hr",null,null,-1),lt={class:"mt-3"},ot={class:"row"},at={class:"col-6"},it={class:"pagination pagination-sm"},nt=["onClick"],rt={class:"col-6"},dt={class:"form-group row"},ut={class:"col-sm-6 col-form-label text-end",for:"paginationSelector"},ct={class:"col-sm-6"},ht=e("option",{value:"10"},"10",-1),pt=e("option",{value:"25"},"25",-1),mt=e("option",{value:"50"},"50",-1),ft=e("option",{value:"100"},"100",-1),vt={value:"999999999"},gt={__name:"UserView",setup(l){H();const o=O(),f=N(""),_=N("");return j(()=>{o.LoadUsers()}),(n,p)=>(d(),u(U,null,[A(Ee,{userId:f.value,visible:f.value!=="",onClose:p[0]||(p[0]=t=>f.value="")},null,8,["userId","visible"]),A(ls,{userId:_.value,visible:_.value!=="",onClose:p[1]||(p[1]=t=>_.value="")},null,8,["userId","visible"]),e("div",os,[e("div",as,[e("h1",null,s(n.$t("users.headline")),1)]),e("div",is,[e("div",ns,[e("div",rs,[g(e("input",{"onUpdate:modelValue":p[2]||(p[2]=t=>m(o).filter=t),class:"form-control",placeholder:n.$t("general.search.placeholder"),type:"text",onKeyup:p[3]||(p[3]=(...t)=>m(o).afterPageSizeChange&&m(o).afterPageSizeChange(...t))},null,40,ds),[[b,m(o).filter]]),e("button",{class:"input-group-text btn btn-primary",title:n.$t("general.search.button")},hs,8,us)])])]),e("div",ps,[e("a",{class:"btn btn-primary ms-2",href:"#",title:n.$t("users.button-add-user"),onClick:p[4]||(p[4]=k(t=>f.value="#NEW#",["prevent"]))},_s,8,ms)])]),e("div",gs,[m(o).Count===0?(d(),u("div",bs,[e("h4",null,s(n.$t("users.no-user.headline")),1),e("p",null,s(n.$t("users.no-user.abstract")),1)])):v("",!0),m(o).Count!==0?(d(),u("table",$s,[e("thead",null,[e("tr",null,[e("th",ks,[e("input",{id:"flexCheckDefault",class:"form-check-input",title:n.$t("general.select-all"),type:"checkbox",value:""},null,8,ys)]),ws,e("th",Ps,s(n.$t("users.table-heading.id")),1),e("th",Is,s(n.$t("users.table-heading.email")),1),e("th",Us,s(n.$t("users.table-heading.firstname")),1),e("th",Cs,s(n.$t("users.table-heading.lastname")),1),e("th",Ss,s(n.$t("users.table-heading.source")),1),e("th",Fs,s(n.$t("users.table-heading.peers")),1),e("th",Ds,s(n.$t("users.table-heading.admin")),1),Vs])]),e("tbody",null,[(d(!0),u(U,null,D(m(o).FilteredAndPaged,t=>(d(),u("tr",{key:t.Identifier},[Ls,e("td",zs,[t.Disabled?(d(),u("span",{key:0,class:"text-danger",title:n.$t("users.user-disabled")+" "+t.DisabledReason},Os,8,Es)):v("",!0),t.Locked?(d(),u("span",{key:1,class:"text-danger",title:n.$t("users.user-locked")+" "+t.LockedReason},Ms,8,As)):v("",!0)]),e("td",null,s(t.Identifier),1),e("td",null,s(t.Email),1),e("td",null,s(t.Firstname),1),e("td",null,s(t.Lastname),1),e("td",Ws,[e("span",Rs,s(t.Source),1)]),e("td",Ts,s(t.PeerCount),1),e("td",Hs,[t.IsAdmin?(d(),u("span",{key:0,class:"text-danger",title:n.$t("users.admin")},Ks,8,js)):(d(),u("span",Gs,[e("i",{class:"fa fa-circle-xmark",title:n.$t("users.no-admin")},null,8,Js)]))]),e("td",Qs,[e("a",{href:"#",title:n.$t("users.button-show-user"),onClick:k(y=>_.value=t.Identifier,["prevent"])},Zs,8,Xs),e("a",{href:"#",title:n.$t("users.button-edit-user"),onClick:k(y=>f.value=t.Identifier,["prevent"])},st,8,xs)])]))),128))])])):v("",!0)]),tt,e("div",lt,[e("div",ot,[e("div",at,[e("ul",it,[e("li",{class:E([{disabled:m(o).pageOffset===0},"page-item"])},[e("a",{class:"page-link",onClick:p[5]||(p[5]=(...t)=>m(o).previousPage&&m(o).previousPage(...t))},"«")],2),(d(!0),u(U,null,D(m(o).pages,t=>(d(),u("li",{key:t,class:E([{active:m(o).currentPage===t},"page-item"])},[e("a",{class:"page-link",onClick:y=>m(o).gotoPage(t)},s(t),9,nt)],2))),128)),e("li",{class:E([{disabled:!m(o).hasNextPage},"page-item"])},[e("a",{class:"page-link",onClick:p[6]||(p[6]=(...t)=>m(o).nextPage&&m(o).nextPage(...t))},"»")],2)])]),e("div",rt,[e("div",dt,[e("label",ut,s(n.$t("general.pagination.size"))+":",1),e("div",ct,[g(e("select",{"onUpdate:modelValue":p[7]||(p[7]=t=>m(o).pageSize=t),class:"form-select",onClick:p[8]||(p[8]=t=>m(o).afterPageSizeChange())},[ht,pt,mt,ft,e("option",vt,s(n.$t("general.pagination.all")),1)],512),[[q,m(o).pageSize,void 0,{number:!0}]])])])])])])],64))}};export{gt as default};
